{"ast":null,"code":"\"use strict\";\n\nimport { Coder } from \"./abstract-coder\";\nimport { pack, unpack } from \"./array\";\nexport class TupleCoder extends Coder {\n  constructor(coders, localName) {\n    let dynamic = false;\n    const types = [];\n    coders.forEach(coder => {\n      if (coder.dynamic) {\n        dynamic = true;\n      }\n      types.push(coder.type);\n    });\n    const type = \"tuple(\" + types.join(\",\") + \")\";\n    super(\"tuple\", type, localName, dynamic);\n    this.coders = coders;\n  }\n  defaultValue() {\n    const values = [];\n    this.coders.forEach(coder => {\n      values.push(coder.defaultValue());\n    });\n    // We only output named properties for uniquely named coders\n    const uniqueNames = this.coders.reduce((accum, coder) => {\n      const name = coder.localName;\n      if (name) {\n        if (!accum[name]) {\n          accum[name] = 0;\n        }\n        accum[name]++;\n      }\n      return accum;\n    }, {});\n    // Add named values\n    this.coders.forEach((coder, index) => {\n      let name = coder.localName;\n      if (!name || uniqueNames[name] !== 1) {\n        return;\n      }\n      if (name === \"length\") {\n        name = \"_length\";\n      }\n      if (values[name] != null) {\n        return;\n      }\n      values[name] = values[index];\n    });\n    return Object.freeze(values);\n  }\n  encode(writer, value) {\n    return pack(writer, this.coders, value);\n  }\n  decode(reader) {\n    return reader.coerce(this.name, unpack(reader, this.coders));\n  }\n}","map":{"version":3,"names":["Coder","pack","unpack","TupleCoder","constructor","coders","localName","dynamic","types","forEach","coder","push","type","join","defaultValue","values","uniqueNames","reduce","accum","name","index","Object","freeze","encode","writer","value","decode","reader","coerce"],"sources":["../../src.ts/coders/tuple.ts"],"sourcesContent":[null],"mappings":"AAAA,YAAY;;AAEZ,SAASA,KAAK,QAAwB,kBAAkB;AACxD,SAASC,IAAI,EAAEC,MAAM,QAAQ,SAAS;AAEtC,OAAM,MAAOC,UAAW,SAAQH,KAAK;EAGjCI,YAAYC,MAAoB,EAAEC,SAAiB;IAC/C,IAAIC,OAAO,GAAG,KAAK;IACnB,MAAMC,KAAK,GAAkB,EAAE;IAC/BH,MAAM,CAACI,OAAO,CAAEC,KAAK,IAAI;MACrB,IAAIA,KAAK,CAACH,OAAO,EAAE;QAAEA,OAAO,GAAG,IAAI;;MACnCC,KAAK,CAACG,IAAI,CAACD,KAAK,CAACE,IAAI,CAAC;IAC1B,CAAC,CAAC;IACF,MAAMA,IAAI,GAAI,QAAQ,GAAGJ,KAAK,CAACK,IAAI,CAAC,GAAG,CAAC,GAAG,GAAI;IAE/C,KAAK,CAAC,OAAO,EAAED,IAAI,EAAEN,SAAS,EAAEC,OAAO,CAAC;IACxC,IAAI,CAACF,MAAM,GAAGA,MAAM;EACxB;EAEAS,YAAYA,CAAA;IACR,MAAMC,MAAM,GAAQ,EAAG;IACvB,IAAI,CAACV,MAAM,CAACI,OAAO,CAAEC,KAAK,IAAI;MAC1BK,MAAM,CAACJ,IAAI,CAACD,KAAK,CAACI,YAAY,EAAE,CAAC;IACrC,CAAC,CAAC;IAEF;IACA,MAAME,WAAW,GAAG,IAAI,CAACX,MAAM,CAACY,MAAM,CAAC,CAACC,KAAK,EAAER,KAAK,KAAI;MACpD,MAAMS,IAAI,GAAGT,KAAK,CAACJ,SAAS;MAC5B,IAAIa,IAAI,EAAE;QACN,IAAI,CAACD,KAAK,CAACC,IAAI,CAAC,EAAE;UAAED,KAAK,CAACC,IAAI,CAAC,GAAG,CAAC;;QACnCD,KAAK,CAACC,IAAI,CAAC,EAAE;;MAEjB,OAAOD,KAAK;IAChB,CAAC,EAAgC,EAAG,CAAC;IAErC;IACA,IAAI,CAACb,MAAM,CAACI,OAAO,CAAC,CAACC,KAAY,EAAEU,KAAa,KAAI;MAChD,IAAID,IAAI,GAAGT,KAAK,CAACJ,SAAS;MAC1B,IAAI,CAACa,IAAI,IAAIH,WAAW,CAACG,IAAI,CAAC,KAAK,CAAC,EAAE;QAAE;;MAExC,IAAIA,IAAI,KAAK,QAAQ,EAAE;QAAEA,IAAI,GAAG,SAAS;;MAEzC,IAAIJ,MAAM,CAACI,IAAI,CAAC,IAAI,IAAI,EAAE;QAAE;;MAE5BJ,MAAM,CAACI,IAAI,CAAC,GAAGJ,MAAM,CAACK,KAAK,CAAC;IAChC,CAAC,CAAC;IAEF,OAAOC,MAAM,CAACC,MAAM,CAACP,MAAM,CAAC;EAChC;EAEAQ,MAAMA,CAACC,MAAc,EAAEC,KAA6C;IAChE,OAAOxB,IAAI,CAACuB,MAAM,EAAE,IAAI,CAACnB,MAAM,EAAEoB,KAAK,CAAC;EAC3C;EAEAC,MAAMA,CAACC,MAAc;IACjB,OAAOA,MAAM,CAACC,MAAM,CAAC,IAAI,CAACT,IAAI,EAAEjB,MAAM,CAACyB,MAAM,EAAE,IAAI,CAACtB,MAAM,CAAC,CAAC;EAChE"},"metadata":{},"sourceType":"module"}
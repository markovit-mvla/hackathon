{"ast":null,"code":"import { __awaiter, __generator } from \"tslib\";\nexport function makeJsonRpcPayloadFactory() {\n  var nextId = 0;\n  return function (method, params) {\n    return {\n      method: method,\n      params: params,\n      jsonrpc: \"2.0\",\n      id: \"alc-web3:\" + nextId++\n    };\n  };\n}\nexport function makeJsonRpcSenders(sendJsonRpcPayload, makeJsonRpcPayload) {\n  var _this = this;\n  var send = function (method, params) {\n    return __awaiter(_this, void 0, void 0, function () {\n      var response;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4 /*yield*/, sendJsonRpcPayload(makeJsonRpcPayload(method, params))];\n          case 1:\n            response = _a.sent();\n            if (response.error) {\n              throw new Error(response.error.message);\n            }\n            return [2 /*return*/, response.result];\n        }\n      });\n    });\n  };\n  function sendBatch(parts) {\n    return __awaiter(this, void 0, void 0, function () {\n      var payload, response, message, errorResponse;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            payload = parts.map(function (_a) {\n              var method = _a.method,\n                params = _a.params;\n              return makeJsonRpcPayload(method, params);\n            });\n            return [4 /*yield*/, sendJsonRpcPayload(payload)];\n          case 1:\n            response = _a.sent();\n            if (!Array.isArray(response)) {\n              message = response.error ? response.error.message : \"Batch request failed\";\n              throw new Error(message);\n            }\n            errorResponse = response.find(function (r) {\n              return !!r.error;\n            });\n            if (errorResponse) {\n              throw new Error(errorResponse.error.message);\n            }\n            // The ids are ascending numbers because that's what Payload Factories do.\n            return [2 /*return*/, response.sort(function (r1, r2) {\n              return r1.id - r2.id;\n            }).map(function (r) {\n              return r.result;\n            })];\n        }\n      });\n    });\n  }\n  return {\n    send: send,\n    sendBatch: sendBatch\n  };\n}\nexport function makeResponse(id, result) {\n  return {\n    jsonrpc: \"2.0\",\n    id: id,\n    result: result\n  };\n}","map":{"version":3,"names":["makeJsonRpcPayloadFactory","nextId","method","params","jsonrpc","id","makeJsonRpcSenders","sendJsonRpcPayload","makeJsonRpcPayload","_this","send","__awaiter","response","_a","sent","error","Error","message","result","sendBatch","parts","payload","map","Array","isArray","errorResponse","find","r","sort","r1","r2","makeResponse"],"sources":["../../../src/util/jsonRpc.ts"],"sourcesContent":["import {\n  JsonRpcId,\n  JsonRpcRequest,\n  JsonRpcResponse,\n  SendJsonRpcFunction,\n} from \"../types\";\nimport { SendJsonRpcPayloadFunction } from \"../web3-adapter/sendJsonRpcPayload\";\n\nexport type JsonRpcPayloadFactory = (\n  method: string,\n  params?: any[],\n) => JsonRpcRequest;\n\nexport interface JsonRpcSenders {\n  send: SendJsonRpcFunction;\n  sendBatch(parts: BatchPart[]): Promise<any[]>;\n}\n\nexport interface BatchPart {\n  method: string;\n  params?: any;\n}\n\nexport function makeJsonRpcPayloadFactory(): JsonRpcPayloadFactory {\n  let nextId = 0;\n  return (method, params) => ({\n    method,\n    params,\n    jsonrpc: \"2.0\",\n    id: `alc-web3:${nextId++}`,\n  });\n}\n\nexport function makeJsonRpcSenders(\n  sendJsonRpcPayload: SendJsonRpcPayloadFunction,\n  makeJsonRpcPayload: JsonRpcPayloadFactory,\n): JsonRpcSenders {\n  const send: SendJsonRpcFunction = async (method, params) => {\n    const response = await sendJsonRpcPayload(\n      makeJsonRpcPayload(method, params),\n    );\n    if (response.error) {\n      throw new Error(response.error.message);\n    }\n    return response.result;\n  };\n\n  async function sendBatch(parts: BatchPart[]): Promise<any[]> {\n    const payload = parts.map(({ method, params }) =>\n      makeJsonRpcPayload(method, params),\n    );\n    const response = await sendJsonRpcPayload(payload);\n    if (!Array.isArray(response)) {\n      const message = response.error\n        ? response.error.message\n        : \"Batch request failed\";\n      throw new Error(message);\n    }\n    const errorResponse = response.find((r) => !!r.error);\n    if (errorResponse) {\n      throw new Error(errorResponse.error!.message);\n    }\n    // The ids are ascending numbers because that's what Payload Factories do.\n    return response\n      .sort((r1, r2) => (r1.id as number) - (r2.id as number))\n      .map((r) => r.result);\n  }\n\n  return { send, sendBatch };\n}\n\nexport function makeResponse<T>(id: JsonRpcId, result: T): JsonRpcResponse<T> {\n  return { jsonrpc: \"2.0\", id, result };\n}\n"],"mappings":";AAuBA,OAAM,SAAUA,yBAAyBA,CAAA;EACvC,IAAIC,MAAM,GAAG,CAAC;EACd,OAAO,UAACC,MAAM,EAAEC,MAAM;IAAK,OAAC;MAC1BD,MAAM,EAAAA,MAAA;MACNC,MAAM,EAAAA,MAAA;MACNC,OAAO,EAAE,KAAK;MACdC,EAAE,EAAE,cAAYJ,MAAM;KACvB;EAL0B,CAKzB;AACJ;AAEA,OAAM,SAAUK,kBAAkBA,CAChCC,kBAA8C,EAC9CC,kBAAyC;EAF3C,IAAAC,KAAA;EAIE,IAAMC,IAAI,GAAwB,SAAAA,CAAOR,MAAM,EAAEC,MAAM;IAAA,OAAAQ,SAAA,CAAAF,KAAA;;;;;YACpC,qBAAMF,kBAAkB,CACvCC,kBAAkB,CAACN,MAAM,EAAEC,MAAM,CAAC,CACnC;;YAFKS,QAAQ,GAAGC,EAAA,CAAAC,IAAA,EAEhB;YACD,IAAIF,QAAQ,CAACG,KAAK,EAAE;cAClB,MAAM,IAAIC,KAAK,CAACJ,QAAQ,CAACG,KAAK,CAACE,OAAO,CAAC;;YAEzC,sBAAOL,QAAQ,CAACM,MAAM;QAAC;;;GACxB;EAED,SAAeC,SAASA,CAACC,KAAkB;;;;;;YACnCC,OAAO,GAAGD,KAAK,CAACE,GAAG,CAAC,UAACT,EAAkB;kBAAhBX,MAAM,GAAAW,EAAA,CAAAX,MAAA;gBAAEC,MAAM,GAAAU,EAAA,CAAAV,MAAA;cACzC,OAAAK,kBAAkB,CAACN,MAAM,EAAEC,MAAM,CAAC;YAAlC,CAAkC,CACnC;YACgB,qBAAMI,kBAAkB,CAACc,OAAO,CAAC;;YAA5CT,QAAQ,GAAGC,EAAA,CAAAC,IAAA,EAAiC;YAClD,IAAI,CAACS,KAAK,CAACC,OAAO,CAACZ,QAAQ,CAAC,EAAE;cACtBK,OAAO,GAAGL,QAAQ,CAACG,KAAK,GAC1BH,QAAQ,CAACG,KAAK,CAACE,OAAO,GACtB,sBAAsB;cAC1B,MAAM,IAAID,KAAK,CAACC,OAAO,CAAC;;YAEpBQ,aAAa,GAAGb,QAAQ,CAACc,IAAI,CAAC,UAACC,CAAC;cAAK,QAAC,CAACA,CAAC,CAACZ,KAAK;YAAT,CAAS,CAAC;YACrD,IAAIU,aAAa,EAAE;cACjB,MAAM,IAAIT,KAAK,CAACS,aAAa,CAACV,KAAM,CAACE,OAAO,CAAC;;YAE/C;YACA,sBAAOL,QAAQ,CACZgB,IAAI,CAAC,UAACC,EAAE,EAAEC,EAAE;cAAK,OAACD,EAAE,CAACxB,EAAa,GAAIyB,EAAE,CAACzB,EAAa;YAArC,CAAqC,CAAC,CACvDiB,GAAG,CAAC,UAACK,CAAC;cAAK,OAAAA,CAAC,CAACT,MAAM;YAAR,CAAQ,CAAC;QAAC;;;;EAG1B,OAAO;IAAER,IAAI,EAAAA,IAAA;IAAES,SAAS,EAAAA;EAAA,CAAE;AAC5B;AAEA,OAAM,SAAUY,YAAYA,CAAI1B,EAAa,EAAEa,MAAS;EACtD,OAAO;IAAEd,OAAO,EAAE,KAAK;IAAEC,EAAE,EAAAA,EAAA;IAAEa,MAAM,EAAAA;EAAA,CAAE;AACvC"},"metadata":{},"sourceType":"module"}